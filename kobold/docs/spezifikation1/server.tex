\section{Der Kobold Server}

Der Kobold Server koordiniert die Arbeit der Benutzer von Kobold. Ein Benutzer ist dabei jede Person
mit einem Benutzernamen und dem dazu passenden Passwort. Dieser ist dadurch bei seiner Arbeit nicht an einen
festen Rechner gebunden, sondern kann von jedem Rechner mit einem Kobold Client über den Kobold Server an 
seine Daten gelangen und diese bearbeiten. Ausserdem ermöglicht
der Server eine Client-zu-Client-Kommunikation über eine Nachrichten-Queue, welche
in regelmässigen Abständen von den Clients abgefragt wird (Request/Response).\par

Der Server wird als HTTP-basierter {\it XML-RPC Server}
\footnote{Nähere Informationen: http://ws.apache.org/xmlrpc/}
implementiert und ist SSL-basiert. 
Alle Informationen, die der Server bereitstellt sind persistent.


\subsection{Berechtigungskonzept}

Zur Realisierung des produktlinien\-übergreifenden Berechtigungskonzepts
verwaltet der Server alle benutzer-, rollen-, produktlinien- und
produkt-basierten Berechtigungen. Dabei kann ein Server produktlinien-übergreifend
verwendet werden.\par
Der Server bietet ein auf diesen Berechtigungen basierenden
Authentifizierungsmechanismus an, der von allen Clients verwendet wird. Wird ein Client gestartet, so muss
sich der Benutzer über einen Dialog beim Server mit Benutzername und Passwort anmelden. Sind beide korrekt, 
so werden in seinen Client die Daten der ihm unterstehenden Produktlinien und Produkte geladen. Der Benutzer
kann dabei nur die Daten verändern, für die er auch eine Berechtigung besitzt.

\subsection{Persistierung}

Die Persistierung aller für das Berechtigungskonzept notwendigen Daten wird
durch eine abstrakte, XML-basierte Persistenzschicht realisiert, die es ermöglicht, die
Datenhaltung flexibel zu organisieren.\par
Die Persistenzschicht dient zur Speicherung aller Rollen-,
Authentifizierungs-, PL- und Produktrelationen. Ihre Grundstruktur ist
baumartig, sie ist im Speicher auf dem aktuellen Stand und
wird innerhalb eines konfigurierbaren Timeouts persistiert (Default = 10 Minuten).\par
In der XML-Struktur werden hierbei die folgenden Elemente persistiert:
\begin{itemize}
\item Benutzer
\item Rollen
\item Repositories
\item Produktlinien
\item Produkte
\item Relationen
\end{itemize}

Für jeden Benutzer werden auf dem Kobold Server folgende Daten gespeichert:
\begin{itemize}
\item Benutzername
\item Passwort
\item eMail
\item Name
\item Liste von Rollen
\end{itemize}

Jeder Benutzer kann mehrere Rollen einnehmen, wie zum Beispiel Produktingenieur für Produkt X oder 
Produktlinieningenieur für Produktlinie YZ. Diese Rollen werden in einer Liste unter dem Benutzernamen 
gespeichert. Dabei besteht jedes Listenelement aus folgenden Daten:
\begin{itemize}
\item Liste von Produkten und Produktlinien
\end{itemize}

Für jedes Produkt und jede Produktlinie in dieser Liste wird außerdem noch eine Liste der zugehörigen 
Repositories angehängt. 
Ist das Element ein Produkt, so werden auch die Daten der dazugehörigen Produktlinie erfasst.\par

Für ein Repository werden dabei folgende Daten gespeichert:
\begin{itemize}
\item Pfad
\item Passwort
\item Benutzername
\item Schreibrecht (ja/nein)
\end{itemize}



\subsection{Nachrichten-Queue}

Der Kobold Server bildet für jeden Kobold-Benutzer eine Nachrichten-Queue. Werden Nachrichten oder 
Workflow-Objekte an einen Benutzer geschickt, so werden diese in der Nachrichten-Queue 
gespeichert und beim nächsten Login des Benutzers an den zuständigen Client weitergeleitet.
Die vom Server angebotene Nachrichten-Queue ist zustandsbehaftet, d.h. nach einem
Stromausfall oder anderen unvorhersehbaren Ereignissen ist die Nachrichten-Queue
in der Regel ohne Datenverlust wiederherstellbar.\par
Dadurch wird ein hoher Grad an Konsistenztreue und Zuverlässigkeit erreicht.\newline

Für Nachrichten auf der Nachrichten-Queue werden folgende Daten benötigt:
\begin{itemize}
\item Absender
\item Empfänger
\item Inhalt
\item Datum
\item ID
\item Priorität
\end{itemize}

\subsection{Regelbasierte Workflowerzeugung}
Führt ein Client eine Aktion aus, so wird diese dem Kobold Server gemeldet. Dieser wendet die Aktion als Fakt
auf die Regelbasis an, die sich auf dem Server befindet. Es werden dabei alle Regeln durchlaufen. Stimmt das 
Ereignis mit der Bedingung einer Regel überein, so 
wird die Konsequenz dieser ausgeführt. Die Ergebnisse dieser Regelkonsequenzen werden zu einem 
Workflow-Objekt zusammengefügt (zum Beispiel eine Reihe von Anweisungen). Ein Workflow-Objekt ist dabei 
eine Art XML-Struktur, die einen Titel und eine Liste aller Regelresultate 
besitzt. Diese Workflow-Objekt wird 
dann auf die Message-Queues der Clients gelegt, für die das Workflow-Objekt relevant ist. \par
Siehe auch Kapitel 4 - Drools.

